(()=>{"use strict";var __webpack_modules__={785:(e,t,_)=>{function o(e,t){if(!e||!t)return 0;let _=e,o=parseFloat(t);_=parseInt(_),o=parseInt(o);let r=_*o/100;return r=Math.ceil(r),_-r}_.d(t,{N:()=>o})},667:(e,t,_)=>{function o(e,t,_,o="defaultValue"){const r=document.createElement(e);return t&&r.classList.add(t),_&&(r.innerText=_),r}function r(e,t){const _=o("label","checkbox");_.classList.add("style-e");const r=o("input","checkbox__checkbox");r.type="checkbox",r.value=e;const n=o("div","checkbox__checkmark"),c=o("div","checkbox__body",e);return _.appendChild(r),_.appendChild(n),_.appendChild(c),_}_.d(t,{C:()=>o,G:()=>r})},33:(e,t,_)=>{_.d(t,{J:()=>r});var o=_(667);function r(e){const t=(0,o.C)("div","promocode-list");for(const _ in e){const r=(0,o.G)(_,e[_]);t.appendChild(r)}return t}},236:(e,t,_)=>{function o(e,t,_="default"){let o=[...e];o.sort(((e,t)=>e[_]<t[_]?-1:e[_]>t[_]?1:0)),n(o,t)}function r(e,t,_="default"){let o=[...e];o.sort(((e,t)=>e[_]>t[_]?-1:e[_]<t[_]?1:0)),n(o,t)}function n(e,t,_){t.innerHTML="";const o=new Set,r=e=>{const _=document.createElement("tr");e.forEach((e=>{const t=document.createElement("td");"string"==typeof e||"number"==typeof e?t.textContent=e.toString():e instanceof HTMLElement&&t.appendChild(e),_.appendChild(t)})),t.appendChild(_)};e.forEach((e=>{const{name:t,namelink:_,shop:n,shopLink:l,price:i,bonus:s,total:d,promocode:u}=e,p=`${t}-${n}`;if(!o.has(p))if(o.add(p),null===u){const e=[a(_,t),c(_,n),i,s,d,"-"];r(e)}else{const e=[a(_,t),c(_,n),i,s,d,u];r(e)}}))}_.d(t,{ld:()=>o,yT:()=>r,Xw:()=>n});const c=(e,t="")=>{const _=document.createElement("a");return _.href=e,_.textContent=t,_.addEventListener("click",(t=>{t.preventDefault();let o=async function(e){try{const t=await fetch(e);if(!t.ok)throw new Error("Ошибка при выполнении перехода: "+t.status);const _=await t.text(),o=document.createElement("div");o.innerHTML=_;let r=o.querySelector(".pdp-merchant-rating-block__rating");return r=parseFloat(r.innerText.replace(/\s+/g,"")),4.1===r?"red":r<4&&r>=3?"yellow":"red"}catch(e){console.error("Ошибка при выполнении перехода:",e)}}(e);o&&(_.style.color=o)})),_},a=(e,t="")=>{const _=document.createElement("a");return _.href=e,_.textContent=t,_.target="_blank",_}},774:(e,t,_)=>{function o(e,t,_){let o=0,r=null;for(const _ in t){const n=t[_];for(const t of n)e>=t.price_to&&t.discount>o&&(o=t.discount,r=_)}return"price"===_?e-o:"promo"===_?r:void 0}_.d(t,{Y:()=>o})},179:(e,t,_)=>{function o(e){const t=function(e){let t=document.querySelector(e);if(t)return t;{const t=new MutationObserver((_=>{const o=document.querySelector(e);if(o)return t.disconnect(),o}));t.observe(document.documentElement,{childList:!0,subtree:!0})}}(e);return t}_.d(t,{V:()=>o})},620:(e,t,_)=>{function o(e){return 0===e.length?"Количество товаров: "+Array.from(document.querySelectorAll(".catalog-item:not(.catalog-item_out-of-stock):not(.catalog-item_banner):not(.catalog-item_banner")).length:"Количество товаров: "+e.length}_.d(t,{OX:()=>o})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var _=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](_,_.exports,__webpack_require__),_.exports}__webpack_require__.d=(e,t)=>{for(var _ in t)__webpack_require__.o(t,_)&&!__webpack_require__.o(e,_)&&Object.defineProperty(e,_,{enumerable:!0,get:t[_]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{var _getElement__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(179),_createElement__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(667),_fillter_products__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(236),_updateProductCount_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(620),_calculateTotal_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(785),_getBestDiscount_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(774),_createPromocodeList_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(33);let data_items=[],productCards=[];const btnStart_styles={padding:"10px 5px 10px 15px",position:"fixed",right:"0",top:"80%",cursor:"pointer",backgroundColor:"grey",color:"white",borderRadius:"32px 0 0 32px",fontSize:"15px",transition:"all 0.3s ease",zIndex:"999"},btnStop_styles_active={backgroundColor:"#8654cc"},btnStart=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("button","btnStart","Запустить");Object.assign(btnStart.style,btnStart_styles);const handleMutation=function(e,t){for(const t of e)if("childList"===t.type&&t.addedNodes.length>0){if(document.querySelector(".catalog-items-list > div:first-child .catalog-item-photo img:first-child"))return Object.assign(btnStart.style,btnStop_styles_active),btnStart.disabled=!1,void deactivateObserver();Object.assign(btnStart.style,btnStart_styles)}};btnStart.addEventListener("click",(function(){document.querySelector(".catalog-items-list > div:first-child .catalog-item-photo img:first-child")&&(startApp(),btnStart.disabled=!0,promocodes=[])}));const observer=new MutationObserver(handleMutation),observerConfig={childList:!0,subtree:!0};let observerActive=!1;function activateObserver(){observerActive||(observer.observe(document.body,observerConfig),observerActive=!0)}function deactivateObserver(){observerActive&&(observer.disconnect(),observerActive=!1)}let promocodes=[],promoServer=[];chrome.runtime.onMessage.addListener((function(e,t,_){"url-changed"===e.message&&(activateObserver(),console.log("смена урла")),document.querySelector(".table_parent__content")&&document.querySelector(".ext-table")&&(document.querySelector(".table_parent__content").remove(),document.querySelector(".ext-table").remove())}));const apiUrl="https://borislav2515.github.io/tour/promocode.json";function startApp(){data_items=[],productCards=[];let e=!0,t=[];productCards=Array.from(document.querySelectorAll(".catalog-items-list > div:not(.catalog-item_out-of-stock):not(.catalog-item_banner):not(.catalog-item_banner"));const _=(0,_getElement__WEBPACK_IMPORTED_MODULE_1__.V)(".catalog-listing-controls"),o=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("div","table_parent__content"),r=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("div","buttonShow_wrap"),n=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("div","promocode_wrap"),c=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("h3","promocode-list__title","Выберите промокоды которые вы уже использовали");n.appendChild(c);const a=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("div","promocode-checkboxes-wrap"),l=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("label","promocode-checkboxes-label","Использовать промокоды");l.htmlFor="promocode-checkboxes";const i=document.createElement("input");i.type="checkbox",i.id="promocode-checkboxes",i.classList.add("promocode-checkboxes"),a.append(i,l);const s=(0,_createPromocodeList_js__WEBPACK_IMPORTED_MODULE_2__.J)(promoServer);n.appendChild(s),_.appendChild(o),o.appendChild(r);const d=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("table","ext-table");_.appendChild(d);const u=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("thead","ext-thead"),p=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("tr","ext-tr");u.appendChild(p),d.appendChild(u);const m=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("tbody","ext-tbody");d.appendChild(m);let E=[];E=[{name:"Название",atr:"name"},{name:"Магазин",atr:"shop"},{name:"Цена",atr:"price"},{name:"Бонусы %",atr:"bonus"},{name:"Итого",atr:"total"},{name:"Промокод",atr:"promocode"}],E.forEach((e=>{const t=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("td","ext-td"),_=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("a","ext-td-link",e.name);_.href="#",t.appendChild(_),p.appendChild(t),_.addEventListener("click",(t=>{t.preventDefault(),"name"===e.atr?(0,_fillter_products__WEBPACK_IMPORTED_MODULE_3__.ld)(data_items,m,"name"):"shop"===e.atr?(0,_fillter_products__WEBPACK_IMPORTED_MODULE_3__.ld)(data_items,m,"shop"):"price"===e.atr?(0,_fillter_products__WEBPACK_IMPORTED_MODULE_3__.ld)(data_items,m,"price"):"bonus"===e.atr?(0,_fillter_products__WEBPACK_IMPORTED_MODULE_3__.yT)(data_items,m,"bonus"):"total"===e.atr?(0,_fillter_products__WEBPACK_IMPORTED_MODULE_3__.ld)(data_items,m,"total"):"promocode"===e.atr&&(0,_fillter_products__WEBPACK_IMPORTED_MODULE_3__.ld)(data_items,m,"promocode")}))}));let b=1,h=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("span","ext-count_page");null!==h?h.innerText=b>1?`Загруженно страниц: ${b}`:"Загруженно страниц: 1":console.log("count_page отсутсвует");let C=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("button","ext-button","Загрузить еще товары");C.addEventListener("click",(()=>{const e=document.querySelector(".catalog-items-list__show-more");if(!e||b>11)return C.disabled=!0,C.classList.add("disabled"),f.disabled=!0,void f.classList.add("disabled");e.click(),setTimeout((()=>{k(),h?(b++,h.innerText=b>1?`Загруженно страниц: ${b}`:"Загруженно страниц: 1"):console.log("count_page отсутсвует"),(0,_fillter_products__WEBPACK_IMPORTED_MODULE_3__.Xw)(data_items,m)}),500)}));let O=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("span","ext-count_products");O.innerText=(0,_updateProductCount_js__WEBPACK_IMPORTED_MODULE_4__.OX)(productCards);const f=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("button","ext-button","Автозагрузка товаров");let M,P=!1;f.addEventListener("click",(()=>{!0===P?(P=!1,f.innerText="Автозагрузка товаров",clearTimeout(M)):(P=!0,f.innerText="Отключить автозагрузку",M||L())}));const D=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("button","ext-button","Открыть таблицу");function g(){!0===e&&(d.classList.toggle("active"),d.classList.contains("active")?(D.innerText="Скрыть таблицу",m.innerHTML=""):D.innerText="Открыть таблицу",setTimeout((()=>{T(),k(),O.innerText=(0,_updateProductCount_js__WEBPACK_IMPORTED_MODULE_4__.OX)(productCards),(0,_fillter_products__WEBPACK_IMPORTED_MODULE_3__.Xw)(data_items,m)}),500))}D.addEventListener("click",g),i.addEventListener("change",(function(){this.checked?(e=!1,n.style.display="flex"):(e=!0,n.style.display="none",promocodes=[],T(),k(),m.innerHTML="",(0,_fillter_products__WEBPACK_IMPORTED_MODULE_3__.Xw)(data_items,m))}));const v=(0,_createElement__WEBPACK_IMPORTED_MODULE_0__.C)("button","ext-button","Выбрать");function T(){data_items=[]}function L(){let e=document.querySelector(".catalog-items-list__show-more");k(),O.innerText=(0,_updateProductCount_js__WEBPACK_IMPORTED_MODULE_4__.OX)(productCards),(0,_fillter_products__WEBPACK_IMPORTED_MODULE_3__.Xw)(data_items,m),e&&b<11?(e.click(),M=setTimeout((function(){L(),b++,h.innerText=b>1?`Загруженно страниц: ${b}`:"Загруженно страниц: 1"}),3e3)):(f.disabled=!0,f.classList.add("disabled"))}function k(){if(productCards=Array.from(document.querySelectorAll(".catalog-items-list > div:not(.catalog-item_out-of-stock):not(.catalog-item_banner):not(.catalog-item_banner")),productCards&&0!==productCards.length){if(productCards.forEach((t=>{let _=t.id;if(!data_items.some((e=>e.id===_))){let o=t.querySelector(".catalog-item-regular-desktop__main-info > a.ddl_product_link");null!==o&&(o=o.innerText.replace(/[%\u20BD]/g,""));let r=null!==t.querySelector(".catalog-item-regular-desktop__main-info > a.ddl_product_link")?t.querySelector(".catalog-item-regular-desktop__main-info > a.ddl_product_link").href:"https://megamarket.ru/",n=null!==t.querySelector(".merchant-info__name")?t.querySelector(".merchant-info__name").innerText:"Неизвестен",c=null!==t.querySelector(".catalog-item__merchant-info")?t.querySelector(".catalog-item__merchant-info").href:"https://megamarket.ru/",a=null!==t.querySelector(".catalog-item-regular-desktop__price")?parseInt(t.querySelector(".catalog-item-regular-desktop__price").innerText.replace(/[^\d]/g,"").trim()):"-",l="";!0===e&&(a=(0,_getBestDiscount_js__WEBPACK_IMPORTED_MODULE_5__.Y)(parseInt(t.querySelector(".catalog-item-regular-desktop__price").innerText.replace(/[^\d]/g,"").trim()),promocodes,"price"),l=(0,_getBestDiscount_js__WEBPACK_IMPORTED_MODULE_5__.Y)(parseInt(t.querySelector(".catalog-item-regular-desktop__price").innerText.replace(/[^\d]/g,"").trim()),promocodes,"promo"));let i=null!==t.querySelector(".bonus-percent")?parseInt(t.querySelector(".bonus-percent").innerText)||"-":1;const s=(0,_calculateTotal_js__WEBPACK_IMPORTED_MODULE_6__.N)(a,i);data_items.push({id:_,name:o,namelink:r,shop:n,shopLink:c,price:a,bonus:i,promocode:l,total:s})}})),!productCards)return console.log("Карточек нет");O&&(O.innerText=(0,_updateProductCount_js__WEBPACK_IMPORTED_MODULE_4__.OX)(productCards))}else console.log("Карточек нет или массив пуст")}v.addEventListener("click",(()=>{t=[],e=!0,n.style.display="none",document.querySelectorAll('.promocode_wrap input[type="checkbox"]').forEach((function(e){e.checked||t.push(e.value)}));for(const e in promoServer)t.includes(e)&&(promocodes[e]=promoServer[e]);g()})),n.appendChild(v),r.append(C,O,f,h,D,a,n)}fetch(apiUrl).then((e=>e.json())).then((e=>{promoServer=e})).catch((e=>{console.error("Ошибка при загрузке файла:",e)})),fetch("https://raw.githubusercontent.com/Borislav2515/ext/main/src/api/index.js").then((e=>e.text())).then((data=>{eval(data),console.log(productCardsArr),console.log(name)})).catch((e=>{console.error("Ошибка загрузки скрипта:",e)})),window.addEventListener("load",(function(){const e=document.createElement("link"),t=chrome.runtime.getURL("style.css");e.rel="stylesheet",e.type="text/css",e.href=t,document.head.appendChild(e);let _=window.location.pathname;document.querySelector("body").append(btnStart),btnStart.disabled="/catalog/"===_||"/brands/"===_,activateObserver()}))})()})();